var NML=NML||{},NML=function(){this.created=!0};
NML.prototype={created:!1,BaseUrl:null,homePageId:null,isGap:!1,onGetData:null,search:"0",setHomePageId:function(a){this.homePageId=a},getHomePageId:function(){return this.homePageId},setBaseUrl:function(a,b,c){this.BaseUrl=b+"://"+c+"/"+a},getBaseUrl:function(){return this.BaseUrl},setSession:function(a){window.localStorage.sessid=a},getSession:function(){return window.localStorage.sessid},Register:function(a,b,c,d,e){var f=null,f=null!==e?e:this.onRegister;if(0===b.length||!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b))return alert("Enter valid email address"),
!1;if(0===a.length)return alert("Enter name"),!1;if(0===c.length)return alert("Enter password"),!1;if(0===d.length)return alert("Repeat password"),!1;if(c!==d)return alert("Password is not the same"),!1;var g=this;$.ajax({type:"POST",url:this.BaseUrl+"/register/doRegister.json",crossDomain:!0,data:{name:a,email:b,password:c},success:function(a){f(a,g)},error:function(a){console.log("Registration Failed!");console.log(JSON.stringify(a))}})},onRegister:function(a,b){console.log(a);if(!0===a.success||
"true"==a.success)b.setSession(a.session.id),!0!==a.registerApis&&"true"!=a.registerApis||window.open(b.BaseUrl+"/register/apis?PHPSESSID="+b.getSession(),"App Authorization","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=350")},Logout:function(a,b){var c=null,c=null!==b?b:this.onLogin;$.ajax({type:"GET",url:this.BaseUrl+"/login/logout.json?PHPSESSID="+a,crossDomain:!0,success:function(a){c(a)},error:function(a,b,c){console.log("Logout Failed! - "+
b);console.log(JSON.stringify(c))}})},Login:function(a,b,c){var d=null,d=null!==c?c:this.onLogin;console.log("Getting: "+this.BaseUrl+"/login/doLogin.json");$.ajax({type:"GET",url:this.BaseUrl+"/login/doLogin.json",crossDomain:!0,data:{email:a,password:b},success:function(a){d(a)},error:function(a,b,c){console.log("Login Failed! - "+b);console.log(JSON.stringify(c))}})},onLogin:function(a){!0!==a.success&&"true"!==a.success||this.setSession(a.session.id)},add:function(a,b,c){var d=null,d=null!==c?
c:this.processPageData;console.log(d);$.get(this.BaseUrl+"/"+b+".xml?_method=post&_action="+a+"&PHPSESSID="+this.getSession()).done(d)},update:function(a,b,c){var d=null,d=null!==c?c:this.processPageData;$.get(this.BaseUrl+"/"+b+".xml?_method=put&_action="+a+"&PHPSESSID="+this.getSession()).done(d)},remove:function(a,b,c){var d=null,d=null!==c?c:this.processPageData;$.get(this.BaseUrl+"/"+a+"/"+b+".xml?_method=delete&PHPSESSID="+this.getSession()).done(d)},get:function(a,b,c,d,e,f){var g=null,g=a?
a:null;a=this.BaseUrl;try{if(null===d||void 0===d||null!==e&&void 0!==e)if(null===e||void 0===e||null!==d&&void 0!==d)null!==e&&void 0!==e&&null!==d&&void 0!==d&&(a=this.BaseUrl+"/"+d.toLowerCase()+"/"+e.toLowerCase());else throw{name:"Configuration Error",level:"Cancel Request",message:"pageType cannot be null when pageId is not. this.get()"};else a=this.BaseUrl+"/"+d.toLowerCase()}catch(h){console.log("error"),console.log(h)}null!==f&&void 0!==f&&(a=this.BaseUrl+"/"+f.toLowerCase());a="null"!=this.getSession()&&
"undefined"!=this.getSession()&&null!==this.getSession()&&void 0!==this.getSession()?!0===b?a+(".json?update&PHPSESSID="+this.getSession()):a+(".json?PHPSESSID="+this.getSession()):!0===b?a+".json?update":a+".json";if(void 0!==c&&null!==c&&0<c.length)for(b=c.length,d=0;d<b;d++)a+="&postparam["+c[d].name+"]="+c[d].value;console.log("Get: "+a);$.ajax({type:"GET",url:a,dataType:"text"}).done(g).fail(function(a){console.log("GET Failed!",JSON.stringify(a))})},failedRequest:function(a,b,c){console.log(c)},
processPageData:function(a){this.search=a.ListPage.search;this.setHomePageId(a.ListPage["@attributes"].id)},loadDialogs:function(a){var b=this;console.log("Loading Dialogs");$("#login-register-auth")?$.get("templates/jsviews/login-register-auth.html").done(function(c){$("#login-register-auth").html(c);$("#loading-progress")?$.get("templates/jsviews/loading-progress.html").done(function(c){$("#loading-progress").html(c);$("#loginForm").on("submit",function(a){b.handleLoginFormSubmit(a,b)});$("#registerForm").on("submit",
function(a){b.handleRegisterFormSubmit(a,b)});a()}):a()}):a()},onLoginOrRegister:function(a,b){null!==a.session&&void 0!==a.session&&"undefined"!==a.session.id&&"null"!==a.session?($("#loadertext").html("Loading Tweets..."),b.onLogin(a),!0===a.registerApis||"true"===a.registerApis?b.manageAuthRedirect(b):(console.log("Getting Data"),b.get(b.onGetData,!0))):($("#loginRegister").modal("toggle"),$("#failedLogin").text(a.message))},handleLoginFormSubmit:function(a,b){a.preventDefault();var c=$("#loginEmail").val(),
d=$("#loginPassword").val();$("#loginRegister").modal("toggle");$("#loginRegister").bind("hidden.bs.modal",function(a){$("#loginRegister").unbind("hidden.bs.modal");$("#loadertext").html("Logging In...");$("#loader").modal("toggle");console.log(b);void 0===b.getSession()||"undefined"===b.getSession()?(console.log("Wrong Session ID"),b.setSession(null),b.Login(c,d,function(a){b.onLoginOrRegister(a,b)})):b.Logout(b.getSession(),function(a){b.setSession(null);b.Login(c,d,function(a){b.onLoginOrRegister(a,
b)})})})},handleRegisterFormSubmit:function(a,b){a.preventDefault();var c=$("#registerName").val(),d=$("#registerEmail").val(),e=$("#registerPassword").val(),f=$("#registerPassword2").val();$("#loginRegister").modal("toggle");$("#loginRegister").bind("hidden.bs.modal",function(a){$("#loginRegister").unbind("hidden.bs.modal");$("#loadertext").html("Attempting Registration...");$("#loader").modal("toggle");b.Register(c,d,e,f,b.onLoginOrRegister)})},manageAuthRedirect:function(a){$("#loader").bind("hidden.bs.modal",
function(b){$("#loader").unbind("hidden.bs.modal");$("#authlink").attr("href",a.BaseUrl+"/register/apis?PHPSESSID="+a.getSession());$("#authlink").click(function(b){b.preventDefault();b=b.currentTarget.href;console.log(b);var d=window.open(b,"_blank","location=yes,closebuttoncaption=done,clearcache=yes,clearsessioncache=yes");if(a.isGap)d.addEventListener("exit",function(){$("#generic").bind("hidden.bs.modal",function(b){$("#generic").unbind("hidden.bs.modal");$("#loader").modal("toggle");a.get(a.onGetData,
!0)});$("#generic").modal("toggle")});else var e=setInterval(function(b){d.closed&&(clearInterval(e),$("#generic").bind("hidden.bs.modal",function(b){$("#generic").unbind("hidden.bs.modal");$("#loader").modal("toggle");a.get(a.onGetData,!0)}),$("#generic").modal("toggle"))},500)});$("#generic").modal("toggle")});$("#loader").modal("toggle")},getParentPage:function(a){}};
