var NML=NML||{};
(function(){NML=function(){this.created=!0};NML.prototype={created:!1,BaseUrl:null,appnml:null,appconfig:[],setAppConfig:function(a){this.appconfig=a;window.localStorage.appconfig=JSON.stringify(a)},handleLogin:null,initWithData:!0,loginIndex:0,loadDialogCallback:null,homePageId:null,isGap:!1,onGetData:null,search:"0",setHomePageId:function(a){this.homePageId=a},getHomePageId:function(){return this.homePageId},setBaseUrl:function(a,b,c){this.BaseUrl=b+"://"+c+"/"+a},getBaseUrl:function(){return this.BaseUrl},setSession:function(a,
b){try{console.log(JSON.stringify(window.localStorage));var c=JSON.parse(window.localStorage.appconfig);c[b].sessid=a;window.localStorage.appconfig=JSON.stringify(c)}catch(d){console.log("ERROR"),console.log(d)}},getSession:function(a){return JSON.parse(window.localStorage.appconfig)[a].sessid},Register:function(a,b,c,d,e){var f=null,f=null!==e?e:this.onRegister;if(0===b.length||!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(b))return alert("Enter valid email address"),
!1;if(0===a.length)return alert("Enter name"),!1;if(0===c.length)return alert("Enter password"),!1;if(0===d.length)return alert("Repeat password"),!1;if(c!==d)return alert("Password is not the same"),!1;var g=this;$.ajax({type:"POST",url:this.BaseUrl+"/register/doRegister.json",crossDomain:!0,data:{name:a,email:b,password:c},success:function(a){f(a,g)},error:function(a){console.log("Registration Failed!");console.log(JSON.stringify(a))}})},onRegister:function(a,b){console.log(a);if(!0===a.success||
"true"==a.success)b.setSession(a.session.id,this.loginIndex),!0!==a.registerApis&&"true"!=a.registerApis||window.open(b.BaseUrl+"/register/apis?PHPSESSID="+b.getSession(),"App Authorization","directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=350")},Logout:function(a,b,c){console.log(this.appnml);var d=null,d=null!==b?b:this.onLogin;this.appnml.setBaseUrl(this.appconfig[this.loginIndex].url,"https","datadipity.com");$.ajax({type:"GET",
url:this.appnml.BaseUrl+"/login/logout.json?PHPSESSID="+a,crossDomain:!0,success:function(a){d(a)},error:function(a,b,c){console.log("Logout Failed! - "+b);console.log(JSON.stringify(c))}})},Login:function(a,b,c,d){var e=null,e=null!==c?c:this.onLogin;$.ajax({type:"GET",url:d.BaseUrl+"/login/doLogin.json",crossDomain:!0,data:{email:a,password:b},success:function(a){console.log(a);e(a)},error:function(a,b,c){console.log("Login Failed! - "+b);console.log(JSON.stringify(c))}})},onLogin:function(a){console.log(JSON.stringify(a));
if(!0===a.success||"true"===a.success)console.log("APPNML - "+this.loginIndex),console.log("INDEX: "+this.loginIndex),console.log("SESSID: "+a.session.id),this.setSession(a.session.id,this.loginIndex),console.log(this.getSession(this.loginIndex))},add:function(a,b,c,d){var e=null,e=null!==c?c:this.processPageData;console.log(e);this.setBaseUrl(this.appconfig[d].url,"https","datadipity.com");$.get(this.BaseUrl+"/"+b+".xml?_method=post&_action="+a+"&PHPSESSID="+this.getSession(d)).done(e)},update:function(a,
b,c,d){var e=null,e=null!==c?c:this.processPageData;this.setBaseUrl(this.appconfig[d].url,"https","datadipity.com");$.get(this.BaseUrl+"/"+b+".xml?_method=put&_action="+a+"&PHPSESSID="+this.getSession()).done(e)},remove:function(a,b,c,d){var e=null,e=null!==c?c:this.processPageData;this.setBaseUrl(this.appconfig[d].url,"https","datadipity.com");$.get(this.BaseUrl+"/"+a+"/"+b+".xml?_method=delete&PHPSESSID="+this.getSession()).done(e)},get:function(a,b,c,d,e,f,g){var h=null,h=b?b:null;this.setBaseUrl(this.appconfig[a].url,
"https","datadipity.com");b=this.BaseUrl;try{if(null===e||void 0===e||null!==f&&void 0!==f)if(null===f||void 0===f||null!==e&&void 0!==e)null!==f&&void 0!==f&&null!==e&&void 0!==e&&(b=this.BaseUrl+"/"+e.toLowerCase()+"/"+f.toLowerCase());else throw{name:"Configuration Error",level:"Cancel Request",message:"pageType cannot be null when pageId is not. this.get()"};else b=this.BaseUrl+"/"+e.toLowerCase()}catch(k){console.log("error"),console.log(k)}null!==g&&void 0!==g&&(b=this.BaseUrl+"/"+g.toLowerCase());
console.log("getting Session");console.log(a);a=this.getSession(a);b="null"!=a&&"undefined"!=a&&null!==a&&void 0!==a?!0===c?b+(".json?update&PHPSESSID="+a):b+(".json?PHPSESSID="+a):!0===c?b+".json?update":b+".json";if(void 0!==d&&null!==d&&0<d.length)for(c=d.length,a=0;a<c;a++)b+="&postparam["+d[a].name+"]="+d[a].value;console.log("Get: "+b);$.ajax({type:"GET",url:b,dataType:"text"}).done(h).fail(function(a){console.log("GET Failed!",JSON.stringify(a))})},failedRequest:function(a,b,c){console.log(c)},
processPageData:function(a){this.search=a.ListPage.search;this.setHomePageId(a.ListPage["@attributes"].id)},loadDialogs:function(a,b,c){this.appnml=b;this.appconfig=c;window.localStorage.appconfig=null!==window.localStorage.appconfig&&void 0!==window.localStorage.appconfig?window.localStorage.appconfig:JSON.stringify(c);this.loadDialogCallback=a;console.log("Loading Dialogs");$("#login-register-auth")?$.get("templates/jsviews/login-register-auth.html").done(function(c){console.log("data got");console.log(c);
$("#login-register-auth").html(c);$("#loading-progress")?$.get("templates/jsviews/loading-progress.html").done(function(c){$("#loading-progress").html(c);$("#loginForm").on("submit",function(a){a.preventDefault();b.handleLoginFormSubmit(a,b)});$("#registerForm").on("submit",function(a){a.preventDefault();b.handleRegisterFormSubmit(a,b)});a()}):a()}):a()},onLoginOrRegister:function(a,b){null!==a.session&&void 0!==a.session&&"undefined"!==a.session.id&&"null"!==a.session?($("#loadertext").html("Loading Tweets..."),
b.onLogin(a),!0===a.registerApis||"true"===a.registerApis?b.manageAuthRedirect(b):(console.log("Getting Data"),b.loginIndex<b.appconfig.length-1?(b.loginIndex++,b.loadDialogs(b.loadDialogCallback,b,b.appconfig)):!0===b.initWithData?($("#loader").modal("toggle"),b.get(0,b.onGetData,!0)):(console.log("Gettign Data"),console.log(b),b.onGetData()))):($("#loginRegister").modal("toggle"),$("#failedLogin").text(a.message))},handleLoginFormSubmit:function(a,b){a.preventDefault();var c=$("#loginEmail").val(),
d=$("#loginPassword").val();b.setBaseUrl(b.appconfig[b.loginIndex].url,"https","datadipity.com");console.log(b);$("#loginRegister").modal("toggle");$("#loginRegister").bind("hidden.bs.modal",function(a){$("#loginRegister").unbind("hidden.bs.modal");$("#loadertext").html("Logging In...");$("#loader").modal("toggle");console.log(b);void 0===b.getSession(b.loginIndex)||"undefined"===b.getSession(b.loginIndex)?(console.log("Wrong Session ID"),b.setSession(null,b.loginIndex),b.Login(c,d,function(a){if(null!==
b.handleLogin)b.handleLogin(a);else b.onLoginOrRegister(a,b)})):(console.log(b),b.Logout(b.getSession(b.loginIndex),function(a){b.setSession(null,b.loginIndex);console.log("Logging In afgter logout");b.Login(c,d,function(a){if(null!==b.handleLogin)b.handleLogin(a);else b.onLoginOrRegister(a,b)})}))})},handleRegisterFormSubmit:function(a,b){a.preventDefault();var c=$("#registerName").val(),d=$("#registerEmail").val(),e=$("#registerPassword").val(),f=$("#registerPassword2").val();$("#loginRegister").modal("toggle");
$("#loginRegister").bind("hidden.bs.modal",function(a){$("#loginRegister").unbind("hidden.bs.modal");$("#loadertext").html("Attempting Registration...");$("#loader").modal("toggle");b.Register(c,d,e,f,b.onLoginOrRegister)})},manageAuthRedirect:function(a){$("#loader").bind("hidden.bs.modal",function(b){$("#loader").unbind("hidden.bs.modal");$("#authlink").attr("href",a.BaseUrl+"/register/apis?PHPSESSID="+a.getSession(a.loginIndex));console.log("OPEN AUTH LINK: "+a.BaseUrl+"/register/apis?PHPSESSID="+
a.getSession(a.loginIndex));$("#authlink").click(function(b){b.preventDefault();b=b.currentTarget.href;console.log(b);var d=window.open(b,"_blank","location=yes");console.log("IS GAP? "+a.isGap);if(a.isGap)d.addEventListener("exit",function(){$("#generic").bind("hidden.bs.modal",function(b){$("#generic").unbind("hidden.bs.modal");console.log("LOgin Index: "+a.loginIndex);console.log("Login Length: "+a.appconfig.length);a.loginIndex<a.appconfig.length-1?(a.loginIndex++,a.loadDialogs(a.loadDialogCallback,
a,a.appconfig)):!0===a.initWithData?($("#loader").modal("toggle"),a.get(a.onGetData,!0)):(console.log("Gettign Data"),console.log(a),a.onGetData())});$("#generic").modal("toggle")});else var e=setInterval(function(b){d.closed&&(console.log("Popup Closed"),clearInterval(e),$("#generic").bind("hidden.bs.modal",function(b){$("#generic").unbind("hidden.bs.modal");console.log("LOgin Index: "+a.loginIndex);console.log("Login Length: "+a.appconfig.length);a.loginIndex<a.appconfig.length-1?(a.loginIndex++,
a.loadDialogs(a.loadDialogCallback,a,a.appconfig)):!0===a.initWithData?($("#loader").modal("toggle"),a.get(a.onGetData,!0)):(console.log("Gettign Data"),console.log(a),a.onGetData())}),$("#generic").modal("toggle"))},500)});$("#generic").modal("toggle")});$("#loader").modal("toggle")},getParentPage:function(a){}}})();
